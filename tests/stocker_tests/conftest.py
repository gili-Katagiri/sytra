from lib.stocker import Stocker
from pathlib import Path
import shutil
import pytest

testroot = Path(__file__+'/../../testocks/').resolve()

h2020 = '''2020-01-01
2020-01-02
2020-01-03
2020-01-13
2020-02-11
2020-02-23
2020-02-24
2020-03-20
2020-04-29
2020-05-03
2020-05-04
2020-05-05
2020-05-06
2020-07-23
2020-07-24
2020-08-10
2020-09-21
2020-09-22
2020-11-03
2020-11-23
2020-12-31'''

h2021='''2021-01-01
2021-01-02
2021-01-03
2021-01-11
2021-02-11
2021-02-23
2021-03-20
2021-04-29
2021-05-03
2021-05-04
2021-05-05
2021-07-19
2021-08-11
2021-09-20
2021-09-23
2021-10-11
2021-11-03
2021-11-23
2021-12-31'''

s4382 = '''"2020/06/29","3,610.0","3,640.0","3,480.0","3,535.0","125,400","-125.0","0","25,000","0.00","-"
"2020/06/30","3,595.0","3,675.0","3,520.0","3,555.0","80,100","+20.0","0","24,900","0.00","-"
"2020/07/01","3,600.0","3,690.0","3,530.0","3,530.0","74,700","-25.0","0","25,800","0.00","-"
"2020/07/02","3,510.0","3,535.0","3,290.0","3,295.0","139,400","-235.0","0","24,700","0.00","-"
"2020/07/03","3,320.0","3,415.0","3,320.0","3,390.0","88,000","+95.0","0","24,400","0.00","-"
"2020/07/06","3,345.0","3,515.0","3,345.0","3,505.0","66,700","+115.0","0","24,300","0.00","-"
"2020/07/07","3,460.0","3,485.0","3,385.0","3,470.0","103,300","-35.0","0","24,400","0.00","-"
"2020/07/08","3,505.0","3,610.0","3,455.0","3,585.0","72,500","+115.0","0","24,500","0.00","-"
"2020/07/09","3,585.0","3,635.0","3,500.0","3,500.0","53,400","-85.0","0","24,400","0.00","-"
"2020/07/10","3,480.0","3,500.0","3,350.0","3,360.0","72,400","-140.0","0","25,100","0.00","-"'''

s6890 = '''"2020/06/29","668.0","671.0","647.0","651.0","591,900","-35.0","0","152,500","0.00","-"
"2020/06/30","670.0","672.0","640.0","649.0","452,900","-2.0","0","152,000","0.00","-"
"2020/07/01","655.0","663.0","642.0","646.0","399,900","-3.0","0","154,400","0.00","-"
"2020/07/02","652.0","653.0","619.0","625.0","612,800","-21.0","0","152,600","0.00","-"
"2020/07/03","625.0","635.0","623.0","635.0","269,300","+10.0","0","151,300","0.00","-"
"2020/07/06","637.0","671.0","636.0","665.0","455,400","+30.0","0","156,200","0.00","-"
"2020/07/07","680.0","683.0","658.0","665.0","458,800","0.0","0","157,000","0.00","-"
"2020/07/08","653.0","679.0","653.0","673.0","427,700","+8.0","0","156,100","0.00","-"
"2020/07/09","670.0","676.0","660.0","668.0","361,000","-5.0","0","156,100","0.00","-"
"2020/07/10","664.0","665.0","648.0","651.0","401,500","-17.0","0","312,000","0.00","-"'''

sum0713 = '''2020-07-13
Code,Open,High,Low,Close,Volume,Compare,MDB,MSB,RMB,Backword
4382,3430,3460,3380,3425,40000,65,0,25100,0,0
6890,654,670,654,670,266900,19,0,312000,0,0
'''

@pytest.fixture(scope='class')
def stocker_init_fixture():
    if testroot.exists():
        shutil.rmtree(str(testroot))

    Stocker.stocker_init(rootdir=str(testroot), daystr='2020-07-10')
        
    # directory for holidays
    hol20 = testroot/'holidays'/'2020.csv'
    hol21 = testroot/'holidays'/'2021.csv'
    # write out
    with hol20.open(mode='w') as f: f.write(h2020)
    with hol21.open(mode='w') as f: f.write(h2021)

    # directory for prepare
    pre4382 = testroot/'prepare'/'4382.csv'
    pre6890 = testroot/'prepare'/'6890.csv'
    # write out
    with pre4382.open(mode='w') as f: f.write(s4382)
    with pre6890.open(mode='w') as f: f.write(s6890)
    
    # sbase.csv
    sbpath = testroot/'summary.csv'
    with sbpath.open(mode='w') as f: f.write(sum0713)

    yield str(testroot), (hol20, hol21, pre4382, pre6890) 
